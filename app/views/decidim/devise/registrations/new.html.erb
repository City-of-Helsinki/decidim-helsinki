<% add_decidim_page_title(t(".sign_up")) %>

<% content_for :devise_links do %>
  <%= render "decidim/devise/shared/links" %>
<% end %>

<div class="wrapper">
  <div class="row">
    <div class="columns large-8 page-title">
      <h1><%= t(".sign_up") %></h1>
    </div>
  </div>
  <div class="row margin-bottom-3">
    <div class="columns large-8">
      <div class="static__content">
        <p>
          <%= t(".sign_up_service_account_description") %>
        </p>
        <p>
          <%= t(".already_have_an_account?") %>
          <%= link_to t(".sign_in"), new_user_session_path %>
        </p>
      </div>

      <%= decidim_form_for(@form, as: resource_name, url: registration_path(resource_name), html: { class: "register-form new_user", id: "register-form" }) do |f| %>
        <%= invisible_captcha %>

        <div class="field">
          <%= f.text_field :name, help_text: t(".username_help") %>
        </div>
        <div class="field">
          <%= f.text_field :nickname, help_text: t(".nickname_help", organization: current_organization.name) %>
        </div>
        <div class="field">
          <%= f.email_field :email %>
        </div>
        <div class="field">
          <%= f.password_field :password, autocomplete: "off" %>
        </div>
        <div class="field">
          <%= f.password_field :password_confirmation %>
        </div>

        <div class="field-section margin-bottom-1">
          <h2 class="h3"><%= t(".tos_title") %></h2>

          <% if false %>
            <p class="tos-text">
              <%= strip_tags(translated_attribute(terms_and_conditions_page.content)) %>
            </p>
          <% end %>
          <div class="field">
            <%= f.check_box :tos_agreement, label: t(".tos_agreement", link: link_to(t(".terms"), page_path("terms-and-conditions"))) %>
          </div>
        </div>

        <div class="field-section">
          <h2 class="h3"><%= t(".newsletter_title") %></h2>

          <div class="field">
            <%= f.check_box :newsletter, label: t(".newsletter"), checked: @form.newsletter %>
          </div>
        </div>

        <div class="actions">
          <div class="actions">
            <%= f.submit t("devise.registrations.new.sign_up"), class: "button expanded" %>
          </div>
          <%= yield :devise_links %>
        </div>
      <% end %>
    </div>
  </div>
</div>

<%= render "decidim/devise/shared/newsletter_modal" %>

<% if params[:user] %>
  <%= javascript_tag defer: 'defer' do -%>
  setTimeout(function() {
    var $button = $('#register_toggle');
    $button.trigger('click.zf.trigger').scrollTo();
  }, 500);
  <% end -%>
<% else %>
  <%= javascript_tag defer: 'defer' do -%>
  if (window.location.hash == '#register_section') {
    setTimeout(function() {
      $('#register_toggle').trigger('click.zf.trigger');
      $('input#user_name').focus();
    }, 500);
  }
  <% end %>
<% end %>
